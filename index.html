<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Jogo da Velha</title>

<style>
    body {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100vh;
        background: #fafafa;
        font-family: Arial, sans-serif;
    }

    h1 { margin-bottom: 10px; }

    .modo {
        margin-bottom: 20px;
        font-size: 18px;
    }

    .board {
        display: grid;
        grid-template-columns: repeat(3, 120px);
        grid-template-rows: repeat(3, 120px);
        gap: 5px;
        position: relative;
    }

    .cell {
        width: 120px;
        height: 120px;
        background: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 60px;
        cursor: pointer;
        border: 2px solid #000;
        user-select: none;
    }

    .cell:hover {
        background: #e6e6e6;
    }

    /* LINHA DA VITÓRIA – mais fina */
    #winLine {
        position: absolute;
        height: 3px;
        background: red;
        width: 0;
        transform-origin: 0 0;
        transition: 0.4s ease;
        pointer-events: none;
    }

    button {
        margin-top: 15px;
        padding: 10px 20px;
        font-size: 16px;
        cursor: pointer;
    }
</style>
</head>
<body>

<h1>Jogo da Velha</h1>

<div class="modo">
    <label><input type="radio" name="modo" value="2p" checked> 2 Jogadores</label>
    <label><input type="radio" name="modo" value="bot"> Jogar contra Robô</label>
</div>

<div class="board" id="board">
    <div class="cell" data-id="0"></div>
    <div class="cell" data-id="1"></div>
    <div class="cell" data-id="2"></div>
    <div class="cell" data-id="3"></div>
    <div class="cell" data-id="4"></div>
    <div class="cell" data-id="5"></div>
    <div class="cell" data-id="6"></div>
    <div class="cell" data-id="7"></div>
    <div class="cell" data-id="8"></div>

    <div id="winLine"></div>
</div>

<button onclick="resetGame()">Reiniciar</button>

<script>
const boardEl = document.getElementById("board");
const cells = document.querySelectorAll(".cell");
const line = document.getElementById("winLine");

let board = ["", "", "", "", "", "", "", "", ""];
let turn = "X";
let gameOver = false;

const wins = [
    [0,1,2],[3,4,5],[6,7,8],
    [0,3,6],[1,4,7],[2,5,8],
    [0,4,8],[2,4,6]
];

cells.forEach(cell => {
    cell.onclick = () => {
        if (gameOver) return;

        const i = cell.dataset.id;
        if (board[i] !== "") return;

        const modo = document.querySelector("input[name='modo']:checked").value;

        board[i] = turn;
        cell.textContent = turn;

        const win = checkWin(turn);
        if (win) {
            showLine(win);

            // Mensagem só após a linha aparecer completamente
            setTimeout(() => {
                alert("Parabéns pela vitória!");
            }, 450);

            gameOver = true;
            return;
        }

        if (board.every(v => v !== "")) {
            alert("Empate!");
            return;
        }

        turn = turn === "X" ? "O" : "X";

        if (modo === "bot" && turn === "O") {
            setTimeout(botPlay, 300);
        }
    }
});

function checkWin(p) {
    for (let pattern of wins) {
        if (pattern.every(i => board[i] === p)) return pattern;
    }
    return null;
}

function showLine(pattern) {
    const pos = {
        0:[0,0],1:[1,0],2:[2,0],
        3:[0,1],4:[1,1],5:[2,1],
        6:[0,2],7:[1,2],8:[2,2]
    };

    const [a,b,c] = pattern;
    const start = pos[a];
    const end = pos[c];

    const x1 = start[0] * 125 + 60;
    const y1 = start[1] * 125 + 60;
    const x2 = end[0] * 125 + 60;
    const y2 = end[1] * 125 + 60;

    const length = Math.hypot(x2 - x1, y2 - y1);
    const angle = Math.atan2(y2 - y1, x2 - x1) * 180/Math.PI;

    line.style.left = x1 + "px";
    line.style.top = y1 + "px";
    line.style.width = length + "px";
    line.style.transform = `rotate(${angle}deg)`;
}

function resetGame() {
    board = ["","","","","","","","",""];
    turn = "X";
    gameOver = false;
    line.style.width = "0px";
    cells.forEach(c => c.textContent = "");
}

/* IA FORTALECIDA */
function botPlay() {
    const best = minimax(board, "O").index;

    board[best] = "O";
    cells[best].textContent = "O";

    const win = checkWin("O");
    if (win) {
        showLine(win);
        setTimeout(() => {
            alert("Parabéns pela vitória!");
        }, 450);
        gameOver = true;
        return;
    }

    if (board.every(v => v !== "")) {
        alert("Empate!");
        return;
    }

    turn = "X";
}

function minimax(newBoard, player) {
    const avail = newBoard.map((v,i)=>v===""?i:null).filter(v=>v!==null);

    if (winner(newBoard, "X")) return {score: -10};
    if (winner(newBoard, "O")) return {score: 10};
    if (avail.length === 0) return {score: 0};

    const moves = [];

    for (let i of avail) {
        const move = {};
        move.index = i;
        newBoard[i] = player;

        move.score = player === "O"
        ? minimax(newBoard, "X").score
        : minimax(newBoard, "O").score;

        newBoard[i] = "";
        moves.push(move);
    }

    return player === "O"
    ? moves.reduce((a,b)=>a.score > b.score ? a : b)
    : moves.reduce((a,b)=>a.score < b.score ? a : b);
}

function winner(b,p) {
    return wins.some(pattern => pattern.every(i => b[i] === p));
}
</script>

</body>
</html>
